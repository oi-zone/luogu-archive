model Article {
  lid String @id @db.Char(8)

  time       DateTime @db.Timestamp(0)
  author     User     @relation(fields: [authorId], references: [id])
  authorId   Int
  upvote     Int
  replyCount Int
  favorCount Int

  updatedAt DateTime

  snapshots ArticleSnapshot[]
  replies   ArticleReply[]

  @@index([time])
  @@index([authorId])
  @@index([upvote(sort: Desc)])
  @@index([replyCount(sort: Desc)])
  @@index([favorCount(sort: Desc)])
}

model ArticleSnapshot {
  article   Article @relation(fields: [articleId], references: [lid])
  articleId String  @db.Char(8)

  title String

  category       Int
  status         Int
  solutionFor    Problem?           @relation(fields: [solutionForPid], references: [pid])
  solutionForPid String?
  promoteStatus  Int
  collection     ArticleCollection? @relation(fields: [collectionId], references: [id])
  collectionId   Int?

  content String @db.Text

  adminNote String?

  capturedAt DateTime
  lastSeenAt DateTime

  @@id([articleId, capturedAt])
  @@index([articleId])
  @@index([articleId, capturedAt(sort: Desc)])
}

model ArticleCollection {
  id   Int    @id
  name String

  articleSnapshots ArticleSnapshot[]
}

model ArticleReply {
  id        Int      @id
  article   Article  @relation(fields: [articleId], references: [lid])
  articleId String   @db.Char(8)
  author    User     @relation(fields: [authorId], references: [id])
  authorId  Int
  time      DateTime @db.Timestamp(0)
  content   String

  updatedAt DateTime

  @@index([articleId])
  @@index([authorId])
  @@index([time])
}
